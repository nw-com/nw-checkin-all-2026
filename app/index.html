<!doctype html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>主頁｜西北社區打卡系統</title>
    <style>
      :root{--red:#c62828;--red-dark:#b71c1c;--bg:#f5f5f7;--white:#ffffff;--text:#222;--muted:#666}
      *{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans",sans-serif}
      .a{position:fixed;top:0;left:0;right:0;height:8vh;min-height:56px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;justify-content:space-between;padding:0 14px;z-index:1000}
      .brand{display:flex;align-items:center;gap:10px}
      .logo{width:32px;height:32px;border-radius:50%;background:#fff;border:2px solid var(--red);position:relative}
      .logo .dial{position:absolute;left:50%;top:50%;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid var(--red-dark);transform:translate(-50%,-50%)}
      .logo .center{position:absolute;left:50%;top:50%;width:4px;height:4px;border-radius:50%;background:var(--red-dark);transform:translate(-50%,-50%)}
      .logo .hand{position:absolute;left:50%;top:50%;width:2px;background:var(--red-dark);border-radius:2px;transform-origin:50% 100%}
      .logo .hand.hour{height:8px;transform:translate(-50%,-100%) rotate(300deg)}
      .logo .hand.minute{height:12px;transform:translate(-50%,-100%) rotate(30deg)}
      .title{font-size:16px;font-weight:700;color:var(--red-dark)}
      .a .actions{display:flex;gap:10px}
      .btn{padding:8px 12px;border:none;border-radius:8px;background:var(--red);color:#fff;font-weight:700;transition:transform .15s ease, box-shadow .15s ease;cursor:pointer}
      .btn-secondary{padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;color:#333;font-weight:600;transition:transform .15s ease, box-shadow .15s ease;cursor:pointer}
      .btn:hover,.btn-secondary:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.10)}
      .btn:active,.btn-secondary:active{transform:translateY(0);box-shadow:0 4px 12px rgba(0,0,0,.08)}
      .b{position:fixed;top:8vh;left:0;right:0;height:8vh;min-height:48px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;padding:0 14px;z-index:900}
      .subbar{display:flex;align-items:center;gap:10px;width:100%}
      .tab{padding:8px 16px;border-radius:10px;border:1px solid #eee;background:#fafafa;color:#333;transition:transform .15s ease, box-shadow .15s ease;cursor:pointer}
      .tab:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.10)}
      .tab:active{transform:translateY(0);box-shadow:0 4px 12px rgba(0,0,0,.08)}
      .tab.active{background:#ffecee;color:#b71c1c;border-color:#f8cacc}
      .content{position:absolute;top:16vh;bottom:8vh;left:0;right:0;overflow:auto;padding:10px}
      .c,.d{background:#fff;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:14px}
      .c{height:38vh;min-height:280px;margin-bottom:10px}
      .d{height:38vh;min-height:280px}
      .e{position:fixed;bottom:0;left:0;right:0;height:8vh;min-height:56px;background:#fff;border-top:1px solid #eee;display:flex;align-items:center;justify-content:space-around;padding:0 10px;z-index:1000}
      .e .nav{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer}
      .e .nav a{color:#333;text-decoration:none;font-weight:700}
      .e .nav-icon{width:18px;height:18px;color:#333}
      .e .nav.active .nav-icon{color:var(--red)}
      .e .nav.active a{color:var(--red)}
      .clock{font-family:ui-monospace, Menlo, Consolas, Monaco, monospace;font-size:20px;color:#333;flex:1;display:grid;place-items:center;text-align:center}
      .settings-panel{margin-top:6px}
      .table-wrap{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}
      .table{width:100%;min-width:960px}
      .thead,.row{display:grid;grid-template-columns:56px 1.1fr 1fr 1.4fr 1.2fr 1.3fr 1fr 1fr;gap:8px;align-items:center}
      .thead{padding:8px;border-bottom:1px solid #eee;color:#444;font-weight:700;background:#fafafa;border-radius:10px}
      .row{padding:10px 8px;border-bottom:1px solid #f1f1f1}
      .cell{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
      .avatar{width:32px;height:32px;border-radius:50%;background:#eee;overflow:hidden}
      .avatar img{width:32px;height:32px;object-fit:cover}
      .op{display:flex;gap:8px}
      .op .mini{padding:6px 10px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
      .muted{color:var(--muted)}
      .section-header{display:flex;align-items:center;justify-content:space-between}
      .btn-small{padding:6px 10px;font-size:12px}
      .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:20px;z-index:1100}
      .modal{width:100%;max-width:420px;background:#fff;border-radius:14px}
      .modal header{padding:14px 16px;border-bottom:1px solid #eee;font-weight:700;color:var(--red-dark)}
      .modal .body{padding:16px}
      .modal .actions{display:flex;gap:10px;padding:12px 16px;border-top:1px solid #eee}
    </style>
  </head>
  <body>
    <header class="a">
      <div class="brand">
        <div class="logo"><span class="dial"></span><span class="hand hour"></span><span class="hand minute"></span><span class="center"></span></div>
        <div class="title">主頁</div>
      </div>
      <div class="actions">
        <button id="admin" class="btn-secondary">管理</button>
        <button id="signout" class="btn">登出</button>
      </div>
    </header>
    <nav class="b">
      <div id="subbar" class="subbar"></div>
    </nav>
    <main class="content">
      <section class="c" id="section-c">
        <div class="section-header"><h3 style="margin-top:0">頁中上區域</h3><button id="add-account" type="button" class="btn-secondary btn-small" style="display:none">新增</button></div>
        <div id="user-info" class="muted"></div>
      </section>
      <section class="d" id="section-d">
        <h3 style="margin-top:0">頁中下區域</h3>
        <div id="community-info" class="muted">載入社區資訊中…</div>
      </section>
    </main>
    <footer class="e">
      <div class="nav active" id="nav-home">
        <svg viewBox="0 0 24 24" class="nav-icon" aria-hidden="true">
          <path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 10l9-7 9 7"/>
          <path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M5 11v10h14V11"/>
          <path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M10 21v-6h4v6"/>
        </svg>
        <a href="#">首頁</a>
      </div>
      <div class="nav" id="nav-community">
        <svg viewBox="0 0 24 24" class="nav-icon" aria-hidden="true">
          <path fill="none" stroke="currentColor" stroke-width="2" d="M12 2a7 7 0 0 1 7 7c0 5-7 13-7 13s-7-8-7-13a7 7 0 0 1 7-7z"/>
          <circle cx="12" cy="9" r="2.5" fill="none" stroke="currentColor" stroke-width="2"/>
        </svg>
        <a href="#">社區</a>
      </div>
      <div class="nav" id="nav-settings">
        <svg viewBox="0 0 24 24" class="nav-icon" aria-hidden="true">
          <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
          <line x1="12" y1="2" x2="12" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="12" y1="18" x2="12" y2="22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="2" y1="12" x2="6" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="18" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <a href="#">設定</a>
      </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBa3EfodIJk4hZgH0zEHTlEGqSxncpkIbs",
        authDomain: "nw-checkin-all-2026.firebaseapp.com",
        projectId: "nw-checkin-all-2026",
        storageBucket: "nw-checkin-all-2026.firebasestorage.app",
        messagingSenderId: "840454751760",
        appId: "1:840454751760:web:58bbfa83cb146f4fc7ac95",
        measurementId: "G-NQ0W45T9CK"
      }
      firebase.initializeApp(firebaseConfig)
      const auth = firebase.auth()
      const db = firebase.firestore()

      const userInfo = document.querySelector('#user-info')
      const communityInfo = document.querySelector('#community-info')
      const adminBtn = document.querySelector('#admin')
      const signoutBtn = document.querySelector('#signout')
      let currentRole = 'user'
      let currentUid = ''

      auth.onAuthStateChanged(async (u)=>{
        if (!u) { window.location.href = '../index.html'; return }
        try {
          const doc = await db.collection('users').doc(u.uid).get()
          const data = doc.exists ? doc.data() : {}
          const role = data.role || 'user'
          const community = data.community || ''
          currentRole = role
          currentUid = u.uid
          userInfo.textContent = '使用者：' + (u.email || u.uid) + (role==='admin'?'（管理員）':'')
          communityInfo.textContent = community ? ('社區：' + community) : '尚未設定社區'
          adminBtn.style.display = role==='admin' ? 'inline-block' : 'none'
        } catch(e) {
          userInfo.textContent = '使用者：' + (u.email || u.uid)
          communityInfo.textContent = '無法取得社區資訊'
          adminBtn.style.display = 'none'
        }
      })

      adminBtn.addEventListener('click', ()=>{ window.location.href = '../manage/' })
      signoutBtn.addEventListener('click', async ()=>{ await auth.signOut(); window.location.href = '../index.html' })

      const navHome = document.querySelector('#nav-home')
      const navCommunity = document.querySelector('#nav-community')
      const navSettings = document.querySelector('#nav-settings')
      const subbar = document.querySelector('#subbar')
      let clockTimer = null
      function formatTime(d){
        const p = (n)=>String(n).padStart(2,'0')
        const y = d.getFullYear()
        const m = p(d.getMonth()+1)
        const dd = p(d.getDate())
        const hh = p(d.getHours())
        const mm = p(d.getMinutes())
        const ss = p(d.getSeconds())
        return `${y}-${m}-${dd}    ${hh}:${mm}:${ss}`
      }
      function renderSubbarHome(){
        subbar.innerHTML = `<div class="clock" id="clock"></div>`
        const el = document.querySelector('#clock')
        el.textContent = formatTime(new Date())
        if (clockTimer) clearInterval(clockTimer)
        clockTimer = setInterval(()=>{ el.textContent = formatTime(new Date()) }, 1000)
      }
      function renderSubbarCommunity(){
        if (clockTimer) { clearInterval(clockTimer); clockTimer = null }
        subbar.innerHTML = ''
        const tabs = ['全部','台北','新北','桃園']
        tabs.forEach((t,i)=>{
          const b = document.createElement('button')
          b.className = 'tab' + (i===0?' active':'')
          b.textContent = t
          b.addEventListener('click', ()=>{
            subbar.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'))
            b.classList.add('active')
          })
          subbar.appendChild(b)
        })
      }
      function renderSubbarSettings(){
        if (clockTimer) { clearInterval(clockTimer); clockTimer = null }
        subbar.innerHTML = ''
        const tabs = ['一般','帳號','社區','系統']
        tabs.forEach((t,i)=>{
          const b = document.createElement('button')
          b.className = 'tab' + (i===0?' active':'')
          b.textContent = t
          b.addEventListener('click', ()=>{
            subbar.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'))
            b.classList.add('active')
            renderSettingsPanel(t)
          })
          subbar.appendChild(b)
        })
        renderSettingsPanel('一般')
      }
      async function renderSettingsPanel(tab){
        const c = document.querySelector('#section-c')
        const d = document.querySelector('#section-d')
        let panel = document.querySelector('#settings-panel')
        const addBtn = document.querySelector('#add-account')
        if (tab==='帳號') {
          c.querySelector('h3').textContent = '帳號列表'
          addBtn.style.display = 'inline-block'
          if (!panel) { panel = document.createElement('div'); panel.id = 'settings-panel'; panel.className='settings-panel'; c.appendChild(panel) }
          panel.innerHTML = `
            <div class="table-wrap">
            <div class="table">
              <div id="acct-msg" style="margin:6px 0"></div>
              <div class="thead">
                <div class="cell">大頭照</div>
                <div class="cell">姓名</div>
                <div class="cell">職稱</div>
                <div class="cell">電子郵件</div>
                <div class="cell">手機號碼</div>
                <div class="cell">角色</div>
                <div class="cell">狀況</div>
                <div class="cell">操作</div>
              </div>
              <div id="acct-rows"></div>
            </div>
            </div>
          `
          ensureAuthUserIncluded()
          await loadAccountsFromFirestore()
          renderAccountRows()
          addBtn.onclick = ()=>{ editingIndex = -1; openAccountModal(null) }
        } else {
          c.querySelector('h3').textContent = '頁中：設定'
          addBtn.style.display = 'none'
          if (panel) { panel.remove() }
        }
      }
      let accounts = JSON.parse(localStorage.getItem('accounts')||'[]')
      let editingIndex = -1
      async function loadAccountsFromFirestore(){
        try{
          let q = db.collection('accounts')
          if (currentRole !== 'admin' && currentUid) {
            q = q.where('createdBy','==', currentUid)
          }
          const snap = await q.get()
          const remote = snap.docs.map(d=>({id:d.id, ...d.data()}))
          const local = JSON.parse(localStorage.getItem('accounts')||'[]')
          const emails = new Set(remote.map(a=>a.email))
          accounts = [...remote, ...local.filter(a=>a.email && !emails.has(a.email))]
          localStorage.setItem('accounts', JSON.stringify(accounts))
        }catch(e){
          // 保留本地資料
        }
      }
      function ensureAuthUserIncluded(){
        const u = auth.currentUser
        if (!u) return
        const email = u.email || ''
        const exists = accounts.some(a=>a.email===email)
        if (!exists){
          accounts.push({avatar:'',name:'',title:'',email,phone:'',role:'幹部',status:'在職'})
          localStorage.setItem('accounts', JSON.stringify(accounts))
        }
      }
      function renderAccountRows(){
        const box = document.querySelector('#acct-rows')
        if (!box) return
        box.innerHTML = ''
        accounts.forEach((a,idx)=>{
          const row = document.createElement('div')
          row.className='row'
          row.innerHTML = `
            <div class="cell"><div class="avatar">${a.avatar?`<img src="${a.avatar}">`:''}</div></div>
            <div class="cell">${a.name||'—'}</div>
            <div class="cell">${a.title||'—'}</div>
            <div class="cell">${a.email||'—'}</div>
            <div class="cell">${a.phone||'—'}</div>
            <div class="cell">${a.role||'—'}</div>
            <div class="cell">${a.status||'—'}</div>
            <div class="cell op"><button class="mini" data-idx="${idx}" data-act="edit">編輯</button><button class="mini" data-idx="${idx}" data-act="del">刪除</button></div>
          `
          box.appendChild(row)
        })
        box.querySelectorAll('.mini').forEach(btn=>{
          btn.addEventListener('click', async ()=>{
            const i = Number(btn.getAttribute('data-idx'))
            const act = btn.getAttribute('data-act')
            if (act==='del') {
              const item = accounts[i]
              if (item && item.id){
                try{ await db.collection('accounts').doc(item.id).delete() }catch(e){}
              }
              accounts.splice(i,1)
              localStorage.setItem('accounts', JSON.stringify(accounts))
              renderAccountRows()
            } else if (act==='edit') {
              editingIndex = i
              openAccountModal(accounts[i]||null)
            }
          })
        })
      }
      function openAccountModal(data){
        const titleEl = document.querySelector('#acct-title')
        titleEl.textContent = editingIndex>=0 ? '編輯帳號' : '新增帳號'
        const set = (id, v)=>{ const el = document.getElementById(id); if (el) el.value = v||'' }
        const preview = document.querySelector('#acct-avatar-preview')
        if (editingIndex>=0 && data){
          set('acct-avatar-data', data.avatar||'')
          set('acct-name', data.name||'')
          set('acct-title', data.title||'')
          set('acct-email', data.email||'')
          set('acct-phone', data.phone||'')
          preview.src = data.avatar||''
          const idEl = document.getElementById('acct-docid')
          if (idEl) idEl.value = data.id||''
        } else {
          const f = document.getElementById('acct-form')
          if (f) f.reset()
          preview.src = ''
          const idEl = document.getElementById('acct-docid')
          if (idEl) idEl.value = ''
        }
        document.querySelector('#acct-backdrop').style.display='flex'
        document.querySelector('#acct-backdrop').setAttribute('aria-hidden','false')
        const submitBtn = document.getElementById('acct-submit')
        const msg = document.getElementById('acct-modal-msg')
        if (submitBtn) {
          submitBtn.onclick = ()=>{
            const form = document.getElementById('acct-form')
            if (!form) return
            if (!form.checkValidity()) {
              if (msg) { msg.textContent = '請完整填寫必填欄位'; msg.style.color = '#b71c1c' }
              return
            }
            if (msg) { msg.textContent = '送出中…'; msg.style.color = '#666' }
            handleAccountSubmit()
          }
        }
      }
      function closeAccountModal(){
        document.querySelector('#acct-backdrop').style.display='none'
        document.querySelector('#acct-backdrop').setAttribute('aria-hidden','true')
        const f = document.querySelector('#acct-form')
        if (f) f.reset()
        document.querySelector('#acct-avatar-preview').src=''
        document.querySelector('#acct-avatar-data').value=''
      }
      function compressAvatar(file, cb){
        const r = new FileReader()
        r.onload = ()=>{
          const img = new Image()
          img.onload = ()=>{
            const c = document.createElement('canvas')
            const ctx = c.getContext('2d')
            c.width = 32; c.height = 32
            const s = Math.min(img.width, img.height)
            const sx = (img.width - s)/2
            const sy = (img.height - s)/2
            ctx.drawImage(img, sx, sy, s, s, 0, 0, 32, 32)
            cb(c.toDataURL('image/png'))
          }
          img.src = r.result
        }
        r.readAsDataURL(file)
      }
      async function withTimeout(promise, ms){
        let t
        const timeout = new Promise((_, reject)=>{ t = setTimeout(()=>reject(new Error('timeout')), ms) })
        try { const res = await Promise.race([promise, timeout]); return res } finally { clearTimeout(t) }
      }
      async function handleAccountSubmit(){
        const msgEl = document.getElementById('acct-modal-msg') || document.getElementById('acct-msg')
        const val = (id)=>{ const el = document.getElementById(id); return el ? String(el.value||'').trim() : '' }
        const avatar = val('acct-avatar-data')
        const name = val('acct-name')
        const title = val('acct-title')
        const email = val('acct-email')
        const phone = val('acct-phone')
        const role = '幹部'
        const status = '在職'
        const payload = {avatar,name,title,email,phone,role,status,createdBy:(auth.currentUser&&auth.currentUser.uid)||''}
        try{
          const docidEl = document.getElementById('acct-docid')
          const docId = docidEl ? docidEl.value : ''
          if (editingIndex>=0){
            const existing = accounts[editingIndex]||{}
            const id = docId || existing.id
            if (id){ await withTimeout(db.collection('accounts').doc(id).set(payload, {merge:true}), 3000) }
            accounts[editingIndex] = {...existing, ...payload, id}
          } else {
            const ref = await withTimeout(db.collection('accounts').add({...payload, createdAt: firebase.firestore.FieldValue.serverTimestamp()}), 3000)
            accounts.push({...payload, id: ref.id})
          }
          if (msgEl) { msgEl.textContent = '已儲存'; msgEl.style.color = '#2e7d32' }
        }catch(e){
          if (msgEl) { msgEl.textContent = '雲端儲存失敗，已暫存於本機：' + (e && e.code ? e.code : e && e.message ? e.message : '未知錯誤'); msgEl.style.color = '#b71c1c' }
          if (editingIndex>=0){ const existing = accounts[editingIndex]||{}; accounts[editingIndex] = {...existing, ...payload} } else { accounts.push(payload) }
        }
        localStorage.setItem('accounts', JSON.stringify(accounts))
        renderAccountRows()
        closeAccountModal()
      }
      document.addEventListener('click', (e)=>{
        if (e.target && e.target.id==='acct-cancel') closeAccountModal()
        const backdrop = document.querySelector('#acct-backdrop')
        if (e.target===backdrop) closeAccountModal()
        if (e.target && e.target.id==='add-account') { editingIndex=-1; openAccountModal(null) }
        if (e.target && e.target.id==='acct-submit') {
          const form = document.getElementById('acct-form')
          const msg = document.getElementById('acct-modal-msg')
          if (form) {
            if (!form.checkValidity()) {
              if (msg) { msg.textContent = '請完整填寫必填欄位'; msg.style.color = '#b71c1c' }
              return
            }
            form.requestSubmit()
          }
        }
      })
      document.addEventListener('change', (e)=>{
        if (e.target && e.target.id==='acct-avatar'){
          const f = e.target.files[0]
          if (!f) return
          compressAvatar(f, (data)=>{
            document.querySelector('#acct-avatar-preview').src = data
            document.querySelector('#acct-avatar-data').value = data
          })
        }
      })
      document.addEventListener('submit', async (e)=>{
        if (e.target && e.target.id==='acct-form'){
          e.preventDefault()
          const val = (id)=>{
            const el = document.getElementById(id)
            return el ? String(el.value||'').trim() : ''
          }
          const avatar = val('acct-avatar-data')
          const name = val('acct-name')
          const title = val('acct-title')
          const email = val('acct-email')
          const phone = val('acct-phone')
          const role = '幹部'
          const status = '在職'
          const payload = {avatar,name,title,email,phone,role,status,createdBy:(auth.currentUser&&auth.currentUser.uid)||''}
          try{
            const docidEl = document.getElementById('acct-docid')
            const docId = docidEl ? docidEl.value : ''
            if (editingIndex>=0){
              // 更新
              const existing = accounts[editingIndex]||{}
              const id = docId || existing.id
              if (id){ await db.collection('accounts').doc(id).set(payload, {merge:true}) }
              accounts[editingIndex] = {...existing, ...payload, id}
            } else {
              // 新增
              const ref = await db.collection('accounts').add({...payload, createdAt: firebase.firestore.FieldValue.serverTimestamp()})
              accounts.push({...payload, id: ref.id})
            }
          }catch(e){
            const msgEl = document.getElementById('acct-msg')
            if (msgEl) {
              msgEl.textContent = '雲端儲存失敗，已暫存於本機：' + (e && e.code ? e.code : '未知錯誤')
              msgEl.style.color = '#b71c1c'
            }
            // 若 Firestore 寫入失敗，先以本地保存
            if (editingIndex>=0){
              const existing = accounts[editingIndex]||{}
              accounts[editingIndex] = {...existing, ...payload}
            }else{
              accounts.push(payload)
            }
          }
          localStorage.setItem('accounts', JSON.stringify(accounts))
          renderAccountRows()
          closeAccountModal()
        }
      })
      function setFooter(active){
        navHome.classList.toggle('active', active==='home')
        navCommunity.classList.toggle('active', active==='community')
        navSettings.classList.toggle('active', active==='settings')
        const c = document.querySelector('#section-c')
        const d = document.querySelector('#section-d')
        if (active==='home') {
          c.querySelector('h3').textContent = '頁中上：首頁內容'
          d.querySelector('h3').textContent = '頁中下：首頁內容'
          d.style.display = 'block'
          c.style.height = '38vh'
          c.style.marginBottom = '10px'
          renderSubbarHome()
        } else if (active==='community') {
          c.querySelector('h3').textContent = '頁中上：社區內容'
          d.querySelector('h3').textContent = '頁中下：社區內容'
          d.style.display = 'block'
          c.style.height = '38vh'
          c.style.marginBottom = '10px'
          renderSubbarCommunity()
        } else {
          c.querySelector('h3').textContent = '頁中：設定'
          d.style.display = 'none'
          c.style.height = '76vh'
          c.style.marginBottom = '0'
          renderSubbarSettings()
        }
      }
      navHome.addEventListener('click', (e)=>{e.preventDefault();setFooter('home')})
      navCommunity.addEventListener('click', (e)=>{e.preventDefault();setFooter('community')})
      navSettings.addEventListener('click', (e)=>{e.preventDefault();setFooter('settings')})
      setFooter('home')
    </script>
    <div id="acct-backdrop" class="modal-backdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="acct-title">
        <header id="acct-title">新增帳號</header>
        <div class="body">
          <div id="acct-modal-msg" class="muted" style="margin-bottom:8px"></div>
        <form id="acct-form">
          <div style="margin-bottom:10px">
            <label for="acct-avatar">上傳大頭照</label>
            <input id="acct-avatar" type="file" accept="image/*">
            <div style="margin-top:8px;display:flex;align-items:center;gap:10px">
              <div class="avatar"><img id="acct-avatar-preview" src="" alt=""></div>
              <input id="acct-avatar-data" type="hidden">
              <input id="acct-docid" type="hidden">
              <span style="font-size:12px;color:#666">自動壓縮為 32×32</span>
            </div>
          </div>
            <div style="margin-bottom:10px">
              <label for="acct-name">姓名</label>
              <input id="acct-name" type="text" required>
            </div>
            <div style="margin-bottom:10px">
              <label for="acct-title">職稱</label>
              <input id="acct-title" type="text">
            </div>
            <div style="margin-bottom:10px">
              <label for="acct-email">電子郵件</label>
              <input id="acct-email" type="email" required>
            </div>
            <div style="margin-bottom:10px">
              <label for="acct-phone">手機號碼</label>
              <input id="acct-phone" type="tel" inputmode="tel" required>
            </div>
            <div class="actions">
              <button type="button" id="acct-cancel" class="btn-secondary">取消</button>
              <button type="button" id="acct-submit" class="btn">新增</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
